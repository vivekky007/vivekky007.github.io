<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Two-player Snake</title>
  <style>
    *{box-sizing:border-box;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;}
    body{display:flex;gap:20px;padding:20px;}
    #gameWrap{display:flex;flex-direction:column;gap:8px;}
    canvas{background:#0b2b1a;border:4px solid #063;display:block;}
    #ui{display:flex;gap:8px;align-items:center;}
    button{padding:8px;border-radius:6px;border:1px solid #ccc;}
    #log{width:420px;height:520px;overflow:auto;background:#111;color:#ddd;padding:8px;border-radius:6px;}
    .hint{font-size:12px;color:#666;}
    #controls button{width:80px;height:50px;font-size:18px;}
  </style>
</head>
<body>
  <div id="gameWrap">
    <canvas id="game" width="400" height="400"></canvas>
    <div class="hint">
      Controls: Player A = Arrow keys / buttons, Player B = WASD.
    </div>
    <div id="controls" style="display:flex; flex-direction:column; align-items:center; gap:10px;">
      <button id="btnUp">⬆️</button>
      <div style="display:flex; gap:10px;">
        <button id="btnLeft">⬅️</button>
        <button id="btnRight">➡️</button>
      </div>
      <button id="btnDown">⬇️</button>
    </div>
    <button id="startBtn">Start Game</button>
  </div>
  <div id="log">Logs will appear here</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const cell = 20;
const cols = canvas.width / cell;
const rows = canvas.height / cell;

let gameState = null;
let hostInterval = null;
const colors = { A:'#4ce', B:'#e44', apple:'#ff0' };

function log(msg){
  const logBox = document.getElementById('log');
  const ln = document.createElement('div');
  ln.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
  logBox.appendChild(ln);
  logBox.scrollTop = logBox.scrollHeight;
}

function resetState(){
  return {
    running: false,
    snakes:{
      A:{ dir:{x:1,y:0}, body:[{x:2,y:10},{x:1,y:10},{x:0,y:10}] },
      B:{ dir:{x:-1,y:0}, body:[{x:17,y:9},{x:18,y:9},{x:19,y:9}] }
    },
    apple:{ x: Math.floor(cols/2), y: Math.floor(rows/2) }
  };
}

function startGame(){
  gameState = resetState();
  gameState.running = true;
  log('Game started!');
  if(hostInterval) clearInterval(hostInterval);
  hostInterval = setInterval(tick,150);
}

function tick(){
  if(!gameState.running) return;
  for(const pid of ['A','B']){
    const snake = gameState.snakes[pid];
    const head = { x:snake.body[0].x+snake.dir.x, y:snake.body[0].y+snake.dir.y };
    head.x=(head.x+cols)%cols;
    head.y=(head.y+rows)%rows;
    snake.body.unshift(head);
    if(head.x===gameState.apple.x && head.y===gameState.apple.y){ placeApple(); }
    else{ snake.body.pop(); }
  }
  if(checkCollision('A')||checkCollision('B')){
    gameState.running=false;
    log('Game Over!');
  }
  render();
}

function checkCollision(pid){
  const s=gameState.snakes[pid];
  const head=s.body[0];
  for(let i=1;i<s.body.length;i++) if(s.body[i].x===head.x && s.body[i].y===head.y) return true;
  const other = pid==='A'?gameState.snakes['B']:gameState.snakes['A'];
  for(let j=0;j<other.body.length;j++) if(other.body[j].x===head.x && other.body[j].y===head.y) return true;
  return false;
}

function placeApple(){
  let x,y,ok;
  do{
    x=Math.floor(Math.random()*cols);
    y=Math.floor(Math.random()*rows);
    ok=true;
    for(const pid of ['A','B']){
      if(gameState.snakes[pid].body.some(b=>b.x===x&&b.y===y)){ ok=false; break; }
    }
  }while(!ok);
  gameState.apple={x,y};
}

function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawCell(gameState.apple.x,gameState.apple.y,colors.apple);
  for(const pid of ['A','B']){
    const sn = gameState.snakes[pid];
    for(let i=0;i<sn.body.length;i++){
      const c = i===0 ? shade(colors[pid],-20) : colors[pid];
      drawCell(sn.body[i].x,sn.body[i].y,c);
    }
  }
}

function drawCell(x,y,color){
  ctx.fillStyle=color;
  ctx.fillRect(x*cell+1,y*cell+1,cell-2,cell-2);
}

function shade(hex,percent){
  const num=parseInt(hex.replace('#',''),16);
  const amt=Math.round(2.55*percent);
  let R=(num>>16)+amt, G=(num>>8&0x00FF)+amt, B=(num&0x0000FF)+amt;
  R=R<255?R<0?0:R:255; G=G<255?G<0?0:G:255; B=B<255?B<0?0:B:255;
  return '#'+(0x1000000+(R<<16)+(G<<8)+B).toString(16).slice(1);
}

/* ----------------- Controls ----------------- */
const dirs = { ArrowUp:{x:0,y:-1}, ArrowDown:{x:0,y:1}, ArrowLeft:{x:-1,y:0}, ArrowRight:{x:1,y:0},
               KeyW:{x:0,y:-1}, KeyS:{x:0,y:1}, KeyA:{x:-1,y:0}, KeyD:{x:1,y:0}};

document.addEventListener('keydown', e=>{
  if(!gameState.running) return;
  if(e.code in dirs){
    const dir = dirs[e.code];
    if(e.code.startsWith('Arrow')){
      const snake=gameState.snakes['A'];
      if(!(snake.dir.x===-dir.x && snake.dir.y===-dir.y)) snake.dir=dir;
    } else {
      const snake=gameState.snakes['B'];
      if(!(snake.dir.x===-dir.x && snake.dir.y===-dir.y)) snake.dir=dir;
    }
  }
});

document.getElementById("btnUp").onclick=()=>changeDir('A',{x:0,y:-1});
document.getElementById("btnDown").onclick=()=>changeDir('A',{x:0,y:1});
document.getElementById("btnLeft").onclick=()=>changeDir('A',{x:-1,y:0});
document.getElementById("btnRight").onclick=()=>changeDir('A',{x:1,y:0});

function changeDir(player,dir){
  const snake=gameState.snakes[player];
  if(!(snake.dir.x===-dir.x && snake.dir.y===-dir.y)) snake.dir=dir;
}

document.getElementById("startBtn").onclick=startGame;

/* Initial render */
gameState = resetState();
render();
log('Press "Start Game" to begin!');
</script>
</body>
</html>
